---
title: "poa_safety"
author: "Arielle Herman"
date: "4/9/2022"
output: pdf_document
---

```{r setup, include=FALSE}
source("default_setup.R")
```

# 6.1)People who had difficulty accessing resources  [20]

Run binary distribution over population
Indicators: food, PPE, transportation,housing
Yes = 1+ indicators
No = 0 indicators
Run binary distribution by sub-demographics
Compare and find gaps (test unequal proportions)
Run categorical distribution over population
Run categorical distribution over sub-demographics
Compare and find gaps (test unequal proportions)

- by borough, difficulty accessing cleaning supplies surpasses the other variables
- by decade, overpowered by accessing cleaning supplies and housing



```{r}
mean(wrangled$diff_acc, na.rm = TRUE)

wrangled %>% pivot_longer(cols = c("diff_ran_out", "diff_ppe", "diff_acc", "diff_trans", "diff_hous")) %>%
  select(name, value) %>% group_by(name) %>% summarize(value = mean(value, na.rm = TRUE)) %>%
  ggplot(aes(x = name, y = value)) + geom_col()

demographics
# make a venn diagram

make_plots(wrangled, "race_census", "diff_acc", title = "Difficulty Accessing Resources", show = "true")

make_plots(wrangled, "race_census", "diff_ran_out", title = "Ran out of food", show = "true")
make_plots(wrangled, "race_census", "diff_trans", title = "Difficulty accessing trans", show = "true")
make_plots(wrangled, "race_census", "diff_ppe", title = "Difficulty accessing cleaning supplies", show = "true")
make_plots(wrangled, "race_census", "diff_hous", title = "Difficulty accessing housing", show = "true")
```


# 6.2) Local resource utilized over each challenge[33]

Run distribution of each resource people would turn to for each challenge over population
Run distribution of each resource people would turn to for each challenge over sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
mean(str_detect(wrangled$lr_cc, ";"), na.rm = TRUE)
# lots of respondents just marked off not sure
wrangled %>% filter(str_detect(lr_cc, "not sure")) %>% count(lr_cc)

wrangled %>% filter(if_all(starts_with("lr") & is.character, ~.=="not sure")) %>%
  select(starts_with("lr")) %>% nrow() # people who just marked off not sure for everything

resource_qs <- c("lr_stress_", "lr_cc_", "lr_trans_", "lr_food_", "lr_wtr_", "lr_hc_", "lr_ec_", "lr_hc_")
setNames(resource_qs, resource_qs)

lapply(resource_qs, function(q) {
  
  df <- wrangled %>% pivot_longer(cols = starts_with(q))
  
  make_plots(df, by_vars = "name", hyp_var = "value")[["name"]] +
    labs(subtitle = NULL)
})

wrangled %>% pivot_longer(cols = starts_with("lr_stress_")) %>%
  group_by(name) %>% summarize(mean = mean(value, na.rm = TRUE))

make_plots(stress, by_vars = c("borough", "name"), hyp_var = "value")

```

# 6.3)Which mode of transportation most frequently used [23]

Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
wrangled %>% count(trans)
make_plots(wrangled, demographics, "trans")

wrangled %>% ggplot(aes(x = trans)) + geom_histogram()



wrangled %>% group_by(race_census) %>% count(race_census, trans) %>% arrange(race_census, desc(n)) %>%
  mutate(trans_new = ifelse(row_number() < 3, to_character(trans), "other")) %>%
  group_by(race_census, trans_new) %>% summarize(n = sum(n)) %>%
  group_by(race_census) %>% mutate(denom = sum(n), prop = n/denom) %>%
  arrange(race_census, prop) %>%
  mutate(label = ifelse(row_number()<=2, scales::percent(prop), "")) %>%
  filter(denom > 1) %>% na.omit() %>%
  ggplot(aes(x = prop, y = reorder(race_census, prop), fill = trans_new)) + geom_col(position = "fill") +
  geom_text(aes(label = scales::percent(signif(prop, 2))), position = "fill", hjust = 2)
```

# 6.5) People who experienced difficulty accessing transportation in the past year [20]

Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
mean(wrangled$diff_trans, na.rm = TRUE)

make_plots(wrangled, demographics, "diff_trans")
```

# 6.6) People who are renting public housing or with public assistance were more likely to experience difficulty finding housing in the past six year 

Find respondents who are renters of public housing or rent with public assistance [19]
Find proportion of subset who indicated difficulty finding housing in the past year [20]
Find proportion not in subset who indicated difficulty finding housing in the past year and compare (test unequal proportions)

```{r}
table(wrangled$res_cat)

mean(wrangled$res_cat == "public")

make_plots(wrangled, "res_cat", "diff_hous")
```

# 6.7) Households below median income were more likely to have difficulty with transportation during the pandemic

Find three groups of population who are below median income in 2021 [13]
Find the proportion of each subset of people who had difficulty with transportation [20]
Compare and contrast the three groups on the basis of who faced the highest number of transportation issues and test unequal proportions

```{r}
mean(wrangled$inc_be_med_before, na.rm = TRUE)
wrangled %>% count(inc_dist, diff_trans) %>% mutate_if(is.labelled, to_character)

make_plots(wrangled, "inc_dist", "diff_trans", show = "yes", title = "Difficulty Accessing Transportation")
```


# 6.8)People with limited or no internet access are more likely to use friends and family as resources

Find respondents who have limited internet access or no internet access [22]
Find subset of respondents who are most likely to turn to friends/family for support [33]
it's not "most likely" but did or did not list them
Find proportion not in subset and compare (test unequal proportions)

note: our people with limited internet access will be highly limited

```{r}
mean(wrangled$lr_fam, na.rm = TRUE)
mean(wrangled$internet_acc, na.rm = TRUE)
mean(wrangled$internet_lim, na.rm = TRUE)

count(wrangled, internet) %>% mutate_if(is.labelled, to_character) %>%
  ggplot(aes(x = n, y = reorder(internet, n))) + geom_col()

make_plots(wrangled, "lr_fam", "internet_acc", title = "Strong or Limited Internet Access")
make_plots(wrangled, "lr_fam", "internet_lim", title = "Limited or No Internet Access")
```


# 6.9)People with limited or no internet access are more likely to use faith-based resources

Find respondents who have limited internet access or no internet access [22]
Find subset of respondents who are most likely to use faith-based resources [33]
Find proportion not in subset and compare (test unequal proportions)

```{r}
make_plots(wrangled, "lr_fb", "internet_acc", title = "Strong or Limited Internet Access")
make_plots(wrangled, "lr_fb", "internet_lim", title = "Limited or No Internet Access")
```
