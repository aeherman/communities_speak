---
title: "poa_health_8-13"
author: "Arielle Herman"
date: "3/29/2022"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
source("functions/make_plots.R")
source("thresholds.R")
source("functions/communities_speak_theme.R")
poa <- readRDS("../data/output/poa.rds")
getwd()
#wrangled <- readRDS("../data/output/wrangled20220306.rds")
# maybe load in the poa version of the data
```

# 4.8)People who have experienced abuse or violence due to COVID-19 [36]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)


```{r warning=F, echo = F}
#poa %>% mutate(exp_ab_or_vi = exp_ab_or_vi == 1)

plots <- make_plots(df = mutate(poa, exp_ab_or_vi = exp_ab_or_vi == 1),
           dems = demographics, var = "exp_ab_or_vi",
           title = "Proportion of Respondents to Experience Abuse or Violence due to COVID-19")
#plots$borough

#poa$exp_ab_or_vi == 1
mean(poa %>% filter(borough == "queens") %>% pull(exp_ab_or_vi) == 1, na.rm = TRUE)
```

# 4.9)People who experienced at least one mental health challenge in the last month [41]
Run categorical distribution over population (0-4)
Indicators: responses to [41]
Unable to control: fairly often or very often
Confident: never or almost never
Going your way: never or almost never
Piling up: fairly often or very often
Yes = 1+ indicators
No = 0 indicators
Run distribution by sub-demographics (a-k)


```{r warning=F, echo = F}
#poa %>% select(contains("mntl_hlth")) %>% mutate_if(labelled::is.labelled, labelled::to_factor)
poa %>% mutate(mntl_hlth_bi = mntl_hlth_unc_bi == 1 | mntl_hlth_conf_bi == 0 |
                 mntl_hlth_yourway_bi == 0 | mntl_hlth_pile_bi == 1) %>% select(contains("mntl_hlth")) %>%
  #mutate_if(is.labelled, labelled::to_factor) %>% #filter(mntl_hlth_bi)
# did people mostly choose the middle category?
summarize(across(contains("mntl_hlth"), ~mean(., na.rm = TRUE)))

# validate by changing the "sometimes" coding
# check why mntl_hlth_conf_bi not labelled
df <- poa %>% mutate(mntl_hlth_bi = mntl_hlth_unc_bi == 1 | mntl_hlth_conf_bi == 0 |
                 mntl_hlth_yourway_bi == 0 | mntl_hlth_pile_bi == 1)
make_plots(df, demographics, var = "mntl_hlth_bi", title = "Proportion of Respondents Experiencing\nat Least One Mental Health Challenge")
```

# 4.10)People who are currently unemployed are more likely to experience at least one form of mental health challenge in the last month
Find respondents who are currently unemployed [17]
Find proportion of subset that experienced at least one challenge in the last month [41]
Find proportion not in subset and compare (test unequal proportions)

```{r warning=F, echo = F}
make_plots(df, dems = "unemployed", var = "mntl_hlth_bi", conf = .15)
# filter only desired logical vectors
to_test <- df %>% count(unemployed, mntl_hlth_bi) %>% na.omit %>%
  group_by(unemployed) %>% mutate(denom = sum(n), prop = n/denom) %>% filter(mntl_hlth_bi)
prop.test(to_test$n, to_test$denom)
to_test %>% ggplot() + geom_col(aes(x = prop, y = unemployed))
```

# 4.12)People who have been discriminated against are more likely to experience at least one mental health challenge
Find respondents who have been discriminated against [37]
Find proportion of subset that experienced at least one challenge in the last month [41]
Find proportion not in subset and compare (test unequal proportions)

```{r warning=F, echo = F}
make_plots(df, dems = "discrim_bi", var = "mntl_hlth_bi",
           title = "Proportion of Respondents to experience at least one Mental Health Challenge")
```

# 4.13) People who have expressed hesitancy since the city reopened in approaching a healthcare facility  [40]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r warning=F, echo = F}
# fix show feature
make_plots(poa %>% mutate(hstnt_hc = hstnt_hc == 1),
           dems = demographics, var = "hstnt_hc",
           title = "Proportion of Respondents\nhesitant to approach a healthcare facility")
```





# 4.11)People who have experienced abuse or violence are more likely to experience at least one mental health challenge
Run binary distribution over population [36]
Yes = experienced verbal abuse or physical abuse
No = has not experienced any abuse or violence
Find respondents who have experienced violence or abuse
Find proportion of subset that experienced at least one challenge in the last month [41]
Find proportion not in subset and compare (test unequal proportions)

```{r warning=F, echo = F}
make_plots(df, dems = "exp_ab_or_vi", var = "mntl_hlth_bi",
           title = "Proportion of Respondents to experience at least one Mental Health Challenge")
```

# 4.14)Health will be positively correlated with going back to work in person for respondents above median age
Run distribution by age
Look at health concerns as related to going back to work divided by age category

```{r}
#not sure I understand
```

# 4.15) People who were concerned/ not concerned about the Delta variant
Run distribution over population
Compare distribution by concern about Delta variant

```{r warning=F, echo = F}
make_plots(df %>% mutate(con_vrnts = vrnts == 1), dems = demographics, var = "con_vrnts",
           title = "Proportion Concened about covid variants", min = 10)
```


