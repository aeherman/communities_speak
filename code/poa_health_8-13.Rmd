---
title: "poa_health_8-13"
author: "Arielle Herman"
date: "3/29/2022"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
source("thresholds.R")
#wrangled <- readRDS("../data/output/wrangled20220306.rds")
# maybe load in the poa version of the data
```

# 4.1)Households with a case of COVID-19 [31]

Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
mean(str_detect(poa$posi, "yes"), na.rm = TRUE)

plots <- make_plots(df = poa %>% mutate(posi_yes = str_detect(posi, "yes")),
           by_vars = demographics, hyp_var = "posi_yes", title = "Households with a case of COVID")
plots$decade <- plots$decade + labs(subtitle = NULL)
plots$race_census <- plots$race_census + labs(subtitle = NULL)
plots$sch_level_cat <- plots$sch_level_cat + labs(subtitle = NULL)
plots[c(-5, -13)]
```

## how many unemployed only after and didn't get vaccinated?

```{r}
make_plots(poa %>% filter(emp_change == 1), "vax", "emp_after_un")$vax +
  ggtitle("Percent Individuals who were newly unemployed after\nthe pandemic by Vaccination Status")
```


Individuals with a case of case of COVID-19
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)


4.2)People who have been vaccinated against COVID-19 [32]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
mean(2-poa$vax[poa$vax != 3], na.rm = TRUE)

make_plots(poa %>% #filter(vax != 3, emp_change == 1) %>%
             mutate(vax = 2-vax),
           by_vars = demographics, hyp_var = "vax")[c("sch_level_cat", "hh_ch_0_17_bi", "inc_dist")]

```

4.3)People who have received a booster vaccine dose [38]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
mean(poa$boost == 1, na.rm = TRUE)

make_plots(poa %>% mutate(boost_bi = boost == 1), demographics, "boost_bi")[
  c("borough", "race_census", "not_eng", "sch_level_cat", "inc_dist", "emp_status_after", "res_cat")]
```

4.4)People who returned to work in person are more likely to be vaccinated against COVID-19
Find respondents who returned to work in person or hybrid [20]
Find proportion of subset who reported being at least partially vaccinated against COVID-19 [32]
Find proportion not in subset who reported being at least partially vaccinated against COVID-19 and compare (test unequal proportions)

```{r}
mean(str_detect(poa$wrk, "yes"), na.rm = TRUE)
poa %>% mutate(vax_int = 2-vax) %>% filter(vax_int > 0)
poa$wrk
make_plots(poa %>% mutate(wrk_in = str_detect(to_character(wrk), "yes")), by_vars = "vax", hyp_var = "wrk_in")$vax + ggtitle("Proprotion of Respondents who returned to work hybrid or in-person\nby vaccination status")
```

4.5)People who ranked the government response as average or above average were more likely to be vaccinated against COVID-19
Find respondents who rated the government response as average, good, or excellent [33]
Find proportion of subset who reported being at least partially vaccinated against COVID-19 [32]
Find proportion not in subset who reported being at least partially vaccinated against COVID-19 and compare (test unequal proportions)

## Findings: nope

```{r}
make_plots(poa %>% mutate(rate_gov_pro = if_all(starts_with("rate_gov"), ~.>=3),
                          vax_int = vax == 1),
           "rate_gov_pro", "vax_int")
```

4.7)People who have been discriminated against or are worried about discrimination due to COVID-19 [37]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r}
mean(poa$discrim_bi, na.rm = TRUE)

plots <- make_plots(poa, demographics, "discrim_bi", min = 10)
plots$race_census <- plots$race_census + labs(subtitle = NULL)
```



# 4.8)People who have experienced abuse or violence due to COVID-19 [36]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)


```{r warning=F, echo = F}
#poa %>% mutate(exp_ab_or_vi = exp_ab_or_vi == 1)

plots <- make_plots(df = mutate(poa, exp_ab_or_vi = exp_ab_or_vi == 1),
           by_vars = demographics, hyp_var = "exp_ab_or_vi",
           title = "Proportion of Respondents to Experience Abuse or Violence due to COVID-19")
#plots$borough
#poa$exp_ab_or_vi == 1
mean(poa %>% filter(borough == "queens") %>% pull(exp_ab_or_vi) == 1, na.rm = TRUE)
```

# 4.9)People who experienced at least one mental health challenge in the last month [41]
Run categorical distribution over population (0-4)
Indicators: responses to [41]
Unable to control: fairly often or very often
Confident: never or almost never
Going your way: never or almost never
Piling up: fairly often or very often
Yes = 1+ indicators
No = 0 indicators
Run distribution by sub-demographics (a-k)


```{r warning=F, echo = F}
#poa %>% select(contains("mntl_hlth")) %>% mutate_if(labelled::is.labelled, labelled::to_factor)
poa %>% mutate(mntl_hlth_bi = mntl_hlth_unc_bi == 1 | mntl_hlth_conf_bi == 0 |
                 mntl_hlth_yourway_bi == 0 | mntl_hlth_pile_bi == 1) %>% select(contains("mntl_hlth")) %>%
  #mutate_if(is.labelled, labelled::to_factor) %>% #filter(mntl_hlth_bi)
# did people mostly choose the middle category?
summarize(across(contains("mntl_hlth"), ~mean(., na.rm = TRUE)))

# validate by changing the "sometimes" coding
# check why mntl_hlth_conf_bi not labelled
df <- poa %>% 
  mutate(mntl_hlth_bi = mntl_hlth_unc_bi == 1 | mntl_hlth_conf_bi == 0 |
                 mntl_hlth_yourway_bi == 0 | mntl_hlth_pile_bi == 1)
plots <- make_plots(df, demographics, hyp_var = "mntl_hlth_bi", title = "Proportion of Respondents Experiencing\nat Least One Mental Health Challenge")
plots$decade <- plots$decade + labs(subtitle = "*some statistically significant differences")
plots$sch_level_cat <- plots$sch_level_cat + labs(subtitle = "*some statistically significant differences")
plots
```

# 4.10)People who are currently unemployed are more likely to experience at least one form of mental health challenge in the last month
Find respondents who are currently unemployed [17]
Find proportion of subset that experienced at least one challenge in the last month [41]
Find proportion not in subset and compare (test unequal proportions)

```{r warning=F, echo = F}
make_plots(df, by_vars = "unemployed", hyp_var = "mntl_hlth_bi", conf = .15, title = "Proportion of respondents who have a mental health challenge")
# filter only desired logical vectors
to_test <- df %>% count(unemployed, mntl_hlth_bi) %>% na.omit %>%
  group_by(unemployed) %>% mutate(denom = sum(n), prop = n/denom) %>% filter(mntl_hlth_bi)
#prop.test(to_test$n, to_test$denom)
#to_test %>% ggplot() + geom_col(aes(x = prop, y = unemployed))
```

# 4.12)People who have been discriminated against are more likely to experience at least one mental health challenge
Find respondents who have been discriminated against [37]
Find proportion of subset that experienced at least one challenge in the last month [41]
Find proportion not in subset and compare (test unequal proportions)

```{r warning=F, echo = F}
make_plots(df, by_vars = "discrim_bi", hyp_var = "mntl_hlth_bi",
           title = "Proportion of Respondents to experience\nat least one Mental Health Challenge")$discrim_bi + labs(subtitle = NULL)
```

# 4.13) People who have expressed hesitancy since the city reopened in approaching a healthcare facility  [40]
Run distribution over population
Run distribution by sub-demographics (a-k)
Compare and find gaps (test unequal proportions)

```{r warning=F, echo = F}
# fix show feature
make_plots(poa %>% mutate(hstnt_hc = hstnt_hc == 1),
           by_vars = demographics, hyp_var = "hstnt_hc",
           title = "Proportion of Respondents\nhesitant to approach a healthcare facility")
```

# 4.11)People who have experienced abuse or violence are more likely to experience at least one mental health challenge
Run binary distribution over population [36]
Yes = experienced verbal abuse or physical abuse
No = has not experienced any abuse or violence
Find respondents who have experienced violence or abuse
Find proportion of subset that experienced at least one challenge in the last month [41]
Find proportion not in subset and compare (test unequal proportions)

```{r warning=F, echo = F}
make_plots(df, by_vars = "exp_ab_or_vi", hyp_var = "mntl_hlth_bi",
           title = "Proportion of Respondents to experience at least one Mental Health Challenge")
```

# 4.14)Health will be positively correlated with going back to work in person for respondents above median age
Run distribution by age
Look at health concerns as related to going back to work divided by age category

```{r}
#not sure I understand
```

# 4.15) People who were concerned/ not concerned about the Delta variant
Run distribution over population
Compare distribution by concern about Delta variant

```{r warning=F, echo = F}
plots <- make_plots(df %>% mutate(con_vrnts = vrnts == 1), by_vars = demographics, hyp_var = "con_vrnts",
           title = "Proportion Concened about covid variants", min = 10)

plots$decade <- plots$decade + labs(subtitle = "*some statistically significant differences")

plots
```

```{r eval=F, include=F}

drive_upload(media = "poa_health_8-13.pdf", path = paste0("Communities Speak/Subteams/Data Subteam/Data Findings + VIZ_IS_2/Findings/POA_HEALTH_FULL_ARIELLE_0329.pdf"))
```
