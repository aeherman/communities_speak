---
title: "poa_health_8-13"
author: "Arielle Herman"
date: "3/29/2022"
output:
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
source("../../code/default_setup.R")
#wrangled <- readRDS("../data/output/wrangled20220306.rds")
# maybe load in the poa version of the data
```

# Demographics

```{r}
wrangled %>% ggplot(aes(x = stress_score)) + geom_histogram() +
  ggtitle("Respondent Stress Score [0 - 16]") +
  xlab(NULL) + ylab(NULL)
```

# 4.1 - 4.2

## 4.1)Households with a case of COVID-19 [36]

1.	Run distribution over population
2.	Run distribution by sub-demographics
a.	Compare and find gaps (test unequal proportions)

## 4.2)Individuals with a case of case of COVID-19[36]

1.	Run distribution over population
2.	Run distribution by sub-demographics
a.	Compare and find gaps (test unequal proportions

```{r}
mean(wrangled$posi_all, na.rm = TRUE)
mean(wrangled$posi_yes, na.rm = TRUE)

make_plots(wrangled, by_vars = demographics,
         hyp_var = c("posi_all", "posi_yes"), title = "Households and Individuals with a case of COVID", show = TRUE) #added here show = TRUE
  
cat("Plots for by gen and inc_dist are not showing at least one statistically significant result")
```

# 4.3)People who have received a booster vaccine dose [38]

1.	Run distribution over population
2.	Run distribution by sub-demographics (a-k)
a.	Compare and find gaps (test unequal proportions)

```{r}
mean(wrangled$boost_bi, na.rm = TRUE)

make_plots(wrangled, by_vars=demographics, hyp_var="boost_bi", title = "Respondents who have received a booster vaccine dose", show = TRUE)

cat("Plot for gen is not showing at least one statistically significant result")
```

# 4.4)People who returned to work in person are more likely to be boosted  against COVID-19

1.	Find respondents who returned to work in person or hybrid [19]
a.	Find proportion of subset who reported being at least partially vaccinated against COVID-19 [32]pothes
b.	Find proportion not in subset who reported being at least partially vaccinated against COVID-19 and compare (test unequal proportions)

```{r}
make_plots(wrangled, by_vars = "wrk_in", "boost_bi", title = "Respondents who are at least partially vaccinated")
```

# 4.5, 4.14

## 4.5)People who ranked the government response as average or above average were more likely to be boosted or planning to get boosted  against COVID-19

1.	Find respondents who rated the government response as average, good, or excellent [31]
a.	Find proportion of subset who reported being boosted at least partially planning to get boosted against COVID-19 [37]
b.	Find proportion not in subset who reported being at boosted or at least partly getting  boosted against COVID-19 and compare (test unequal proportions)

## 4.14) People who rated government services (response of government)  above average were more likely to be boosted 
 
1.	Find proportion of population who rate government services above average (city/state or federal) 
2.	Find the booster status amongst the population 
3.	Compare and contrast with the population who rated the response of the government below average.

```{r}
make_plots(wrangled, by_var =c("rate_gov_all_good", "rate_gov_all_bad"), hyp_var ="boost_bi",
           title = "Respondents who were boosted\n")
```

# 4.6)People who have been discriminated against or are worried about discrimination due to COVID-19 [35]]

1.	Run distribution over population
2.	Run distribution by sub-demographics
a.	Compare and find gaps (test unequal proportions)

```{r}
mean(wrangled$discrim_bi, na.rm = TRUE)
make_plots(wrangled, demographics, "discrim_bi", title = "Respondents who experienced or worried about discrimination\n", show =)

cat("Plots for gen and inc_dist do not show at least one statistically significant result")
```

# 4.7)People who have experienced abuse or violence due to COVID-19 [34]

1.	Run distribution over population
2.	Run distribution by sub-demographics (a-k)
a.	Compare and find gaps (test unequal proportions)

```{r}
mean(wrangled$exp_ab_or_vi, na.rm = TRUE)
#poa %>% mutate(exp_ab_or_vi = exp_ab_or_vi == 1)
make_plots(wrangled, by_vars = demographics, hyp_var = "exp_ab_or_vi",
           title = "Respondents who experienced Abuse or Violence due to COVID-19\n", show = TRUE)

cat("Plots for borough, gen, and inc_dist do not show at least one statistically significant result")
```

# 4.8)People who score more than average on the quantified mental health quantified questions [38]

1.	Run categorical distribution over population
2.	Run distribution by sub-demographics

```{r}
make_plots(wrangled, demographics, "stress_bi", title = "People who scored more than average stress\n", show = TRUE)

cat("Plot for gen does not show at least one statistically signifcant result")
```

# 4.9 - 4.12

## 4.9) People who rated government response poorly were more likely to score higher than average on the mental health score.

1.	Find proportion of population who rated government services below average 
2.	Find mental health score amongst people who rated government services below average as compared to those who rated government services above average.

## 4.10)People who are currently unemployed are more likely to score higher than average on the mental health score

1.	Find respondents who are currently unemployed [15]
a.	Find proportion of subset that scored higher than average on the mental health score  [38]
b.	Find proportion not in subset and compare (test unequal proportions)

## 4.11)People who have experienced abuse or violence are more likely to score higher than average on the mental health score

1.	1.Run binary distribution over population [36]
a.	Yes = experienced verbal abuse or physical abuse
b.	No = has not experienced any abuse or violence
2.	Find respondents who have experienced violence or abuse
a.	Find proportion of subset that scored higher than average on the mental health score  [38]
b.	Find proportion not in subset and compare (test unequal proportions)

## 4.12)People who have been discriminated against are more likely to score higher than average on the mental health score

1.Find respondents who have been discriminated against [37]
a.	Find proportion of subset that scored higher than average on the mental health score  [38]
b.	Find proportion not in subset and compare (test unequal proportions)


```{r}
make_plots(wrangled,
           c(
             # 4.9
             "rate_gov_all_good", "rate_gov_all_bad",
             # 4.10
             "emp_after_un",
             # 4.11
             "exp_ab_or_vi",
             "exp_ab_and_vi",
             # 4.12
             "discrim_bi"),
           "stress_bi", title = "Respondents who scored\nhigher than average stress\n", show =TRUE)

cat("Plots for rate_gov_all_bad and exp_ab_and_vi are not showing at least one statistically significant result")

```

# 4.13) Run distribution over each activity which has been avoided because of Covid-19 

1.	Find respondents who avoided any activity because of Covid-19 
2.	Run sub demographic distribution over each activity

```{r}
av_covid <- wrangled %>% select(starts_with("av_covid_") & !ends_with("text")) %>% colnames

lapply(av_covid, function(var) {
  make_plots(wrangled, demographics, var, title = glue::glue("Respondents who avoided {var}"))
})

cat("Plots with no statistically significant result are omitted from printing. See those marked with 'NULL' above.")
```

# 4.15) Distribution over frequency of testing

1.	Run each type of frequency over the sub demographic groups

```{r}
lapply(1:4, function(var) {
  freq <- names(attributes(wrangled$test)$labels[var])
  make_plots(wrangled %>% mutate(test_freq = test == var), demographics, "test_freq",
             title = glue::glue("Respondents who tested {freq}"))
})

cat("Plots with no statistically significant result are omitted from printing. See those marked with 'NULL' above.")
```

# 4.16) Distribution over each difficulty faced while testing

1.	Run each type of difficulty over sub demographic groups 

```{r}
test_diffs <- wrangled %>% select(starts_with("test_diffs_") & !ends_with("text")) %>% colnames

lapply(test_diffs, function(test_diff) {
  difficulty <-
    paste0(survey_codebook_labelled$to_name[survey_codebook_labelled$full_name == test_diff], "\n")
  
  make_plots(wrangled, demographics, test_diff,
             title = paste("Respondents who experienced the following difficulty:", difficulty, sep = "\n"))
})

cat("Plots with no statistically significant result are omitted from printing. See those marked with 'NULL' above.")
```